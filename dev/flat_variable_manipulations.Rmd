---
title: "flat_variable_manipulations.Rmd empty"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
```

<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.
-->
## temperature_groups
    
```{r function-temperature_groups}
#' Regroup axillary temperature values
#' 
#' Creates a new categorical variable based on the body temperature.
#' 
#' @param data.var Data table
#' @param temperature Variable containing body temperature in Celsius
#'
#' @return Creates a new column frame with body temperature ranges
#' 
#' @import dplyr
#' @export
temperature_groups <- function(data.var, temperature ){
    data.var <- data.var %>% mutate(TEMP_CATEG = case_when(data.var[,temperature] < 36  ~ "<36",
                                              data.var[,temperature] >= 36 & data.var[,temperature]<37  ~ "36-36.9",
                                             data.var[,temperature] >= 37 & data.var[,temperature]<38  ~ "37-37.9",
                                             data.var[,temperature] >= 38 & data.var[,temperature]<39  ~ "38-38.9",
                                             data.var[,temperature] >= 30  ~ "≥39"))
    return(data.var)
}
```
  
```{r example-temperature_groups}

df = data.frame(ID = c(1:20), Temperature = runif(20, 36, 42))
temperature_groups(data.var = df, temperature = "Temperature")
```
  
```{r tests-temperature_groups}

```
  
## age_groups
    
```{r function-age_groups}
#' Age groups
#' 
#' Creates a new categorical variable based on age.
#' 
#' @param data.var Data table
#' @param age Variable containing age in years.
#' @param lim1 Age limit for categorization
#' @param lim2 Age limit for categorization
#' @param lim3 Age limit for categorization
#' @param lim4 Age limit for categorization
#' @param lim5 Age limit for categorization
#'
#' @return creates a columns with typical ranges
#' 
#' @import dplyr
#' @export
age_groups <- function(data.var, age, lim1, lim2, lim3=NULL, lim4=NULL, lim5=NULL){
  ifelse(is.null(lim3), 
                 data.var <- data.var %>% mutate(AGE_CATEG = case_when(data.var[,age] < lim1  ~ paste0("<",lim1),
                                              data.var[,age] >= lim1 & data.var[,age]<lim2  ~ paste0(lim1,"-",lim2-1),
                                              data.var[,age] >= lim2  ~ paste0("≥",lim2))), 
                 ifelse(is.null(lim4), data.var <- data.var %>% mutate(AGE_CATEG = case_when(data.var[,age] < lim1  ~ paste0("<",lim1),
                                              data.var[,age] >= lim1 & data.var[,age]<lim2  ~ paste0(lim1,"-",lim2-1),
                                             data.var[,age] >= lim2 & data.var[,age]<lim3  ~ paste0(lim2,"-",lim3-1),
                                             data.var[,age] >= lim2  ~ paste0("≥",lim3))),
                 ifelse(is.null(lim5), data.var <- data.var %>% mutate(AGE_CATEG = case_when(data.var[,age] < lim1  ~ paste0("<",lim1),
                                              data.var[,age] >= lim1 & data.var[,age]<lim2  ~ paste0(lim1,"-",lim2-1),
                                             data.var[,age] >= lim2 & data.var[,age]<lim3  ~ paste0(lim2,"-",lim3-1),
                                             data.var[,age] >= lim3 & data.var[,age]<lim4  ~ paste0(lim3,"-",lim4-1),
                                             data.var[,age] >= lim4  ~ paste0("≥",lim4))),
                                      data.var <- data.var %>% mutate(AGE_CATEG = case_when(data.var[,age] < lim1  ~ paste0("<",lim1),
                                              data.var[,age] >= lim1 & data.var[,age]<lim2  ~ paste0(lim1,"-",lim2-1),
                                             data.var[,age] >= lim2 & data.var[,age]<lim3  ~ paste0(lim2,"-",lim3-1),
                                             data.var[,age] >= lim3 & data.var[,age]<lim4  ~ paste0(lim3,"-",lim4-1),
                                             data.var[,age] >= lim4 & data.var[,age]<lim5  ~ paste0(lim4,"-",lim5-1),
                                             data.var[,age] >= lim5  ~ paste0("≥",lim5))))))

    return(data.var)
}
```
  
```{r example-age_groups}
df = data.frame(ID = c(1:20), AGE = round(runif(20, 3, 86)))
age_groups(data.var = df, age = "AGE", lim1=5, lim2=11, lim3=18, lim4=45, lim5=60)
df = data.frame(ID = c(1:20), AGE = round(runif(20, 3, 25)))
age_groups(data.var = df, age = "AGE", lim1=5, lim2=11, lim3=18)

```
  
```{r tests-age_groups}

```
  

```{r development-inflate, eval=FALSE}
# Run but keep eval=FALSE to avoid infinite loop
# Execute in the console directly
fusen::inflate(flat_file = "dev/flat_variable_manipulations.Rmd", vignette_name = "Minimal")
```
